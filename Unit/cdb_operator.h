/**************************************************************************
File:         cdb_operator.h
Author:       Song Xiaofeng
Date:         2016-05-04
Description:
**************************************************************************/
#pragma once
#include <QThread>
#include <Qtsql/QSqlDatabase>
#include <QtSql/QSqlError>
#include <QtSql/QSqlQuery>
#include "basic_table_structure.h"
#include "basic_data_structure.h"
//////////////////////////////////////////////////////////////////
///    Class:  CDBOperThread
///    Brief:  
//////////////////////////////////////////////////////////////////
class CDBOperThread : public QThread {
	Q_OBJECT
///////////////////////////////////////////////////////////////////
//all public functions are here
///////////////////////////////////////////////////////////////////
public:
	CDBOperThread(QSqlDatabase *pDB) { m_pDB = pDB; }
	void insertIntoTable(const QString table_name, const QString data_path);
	void deleteFromTable(const QString table_name, const QString data_path);
///////////////////////////////////////////////////////////////////
//all properties  are here
///////////////////////////////////////////////////////////////////
private:
	QSqlDatabase *m_pDB;
};
//////////////////////////////////////////////////////////////////
///    Class:  CDBOperator
///    Brief:  
//////////////////////////////////////////////////////////////////
class CDBOperator : public QThread {
	Q_OBJECT


///////////////////////////////////////////////////////////////////
//all public functions are here
///////////////////////////////////////////////////////////////////
public:
	static CDBOperator* getInstance();
	bool createDB(const QString & p_dbPath, const QString & p_dbName);
	bool createTable();
	void openDB() { m_db.open(); }
	void closeDB() { m_db.close(); }
	void run();
///////////////////////////////////////////////////////////////////
//all private functions are here
///////////////////////////////////////////////////////////////////
private:
	CDBOperator();
	~CDBOperator();
///////////////////////////////////////////////////////////////////
//all properties  are here
///////////////////////////////////////////////////////////////////
private:
	QSqlDatabase  m_db;
	QSqlQuery     m_query;
};
